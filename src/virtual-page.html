<!DOCTYPE html>
<html>
	<head>
		<title>Loading...</title>
		<style>

			body {
				overflow-x: hidden;
				background: #263238;
			}

			#app {
				position: absolute;
				top: 0;
				left: 0;
			}
		</style>
	</head>
	<body>

		<img id="app">

		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
		<script>
			const app = document.getElementById('app');
			const socket = io.connect();

			// Save parameters and send them periodically
			let viewportDimensions = null;
			let mousePosition = null;

			socket.on('render', base64 => {
				console.log('Received frame');
				app.setAttribute('src', 'data:image/png;base64,' + base64);
			});

			socket.on('ready', () => {
				console.log('Ready!');
				onResize();
				onMouseMove();
			});

			// Track screen size and send to government
			function onResize() {
				viewportDimensions = {
					width: window.outerWidth,
					height: window.outerHeight
				};
				socket.emit('viewport dimensions', viewportDimensions);
			}
			document.body.onresize = onResize;

			// Track the cursor and also send to government
			function onMouseMove(event) {
				if (event) {
					mousePosition = {
						x: event.pageX,
						y: event.pageY
					};
				}
				if (mousePosition === null) return;
				socket.emit('mouse position', mousePosition);
				console.log('mouse position', mousePosition);
			};
			document.onmousemove = onMouseMove;
		</script>

		<!-- *** jQuery *** -->
		<script src="http://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
	</body>
</html>
